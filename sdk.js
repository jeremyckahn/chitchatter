!function(){var t,e,i,n,s=((n={}).GET_SDK_CONFIG="getSdkConfig",n.IS_EMBEDDED="embed",n.PARENT_DOMAIN="parentDomain",n),o=((t={}).CONFIG="config",t.CONFIG_REQUESTED="configRequested",t),r=((e={}).COLOR_MODE="color-mode",e.PLAY_MESSAGE_SOUND="play-message-sound",e.ROOM_NAME="room",e.ROOT_URL="root-url",e.USER_ID="user-id",e.USER_NAME="user-name",e);let a=Object.values(((i={}).DARK="dark",i.LIGHT="light",i)).map(String),l=["camera","microphone","display-capture","fullscreen"],u=["height","referrerpolicy","sandbox","style","width"];class h extends HTMLElement{static get observedAttributes(){return[...Object.values(r),...u]}get chatConfig(){var t,e;let i={};this.hasAttribute(r.USER_ID)&&(i.userId=null!=(t=this.getAttribute(r.USER_ID))?t:""),this.hasAttribute(r.USER_NAME)&&(i.customUsername=this.getAttribute(r.USER_NAME)),i.playSoundOnNewMessage=!!this.hasAttribute(r.PLAY_MESSAGE_SOUND);let n=null!=(e=this.getAttribute(r.COLOR_MODE))?e:"";return a.includes(n)&&(i.colorMode=n),i}get rootUrl(){var t;return null!=(t=this.getAttribute(r.ROOT_URL))?t:"https://chitchatter.im/"}async listenForConfigRequest(){this.stopListeningForConfigRequest(),window.addEventListener("message",this.handleConfigRequestedMessage),this.configRequestExpirationTimout=setTimeout(()=>{console.error("[chitchatter-sdk] configuration was not sent successfully"),this.stopListeningForConfigRequest()},1e4)}updateIframeAttributes(){var t;let{iframe:e}=this,i=encodeURIComponent(null!=(t=this.getAttribute(r.ROOM_NAME))?t:window.location.href),n=new URLSearchParams({[s.IS_EMBEDDED]:"",[s.GET_SDK_CONFIG]:"",[s.PARENT_DOMAIN]:encodeURIComponent(window.location.origin)}),o=new URL(this.rootUrl);o.pathname=`public/${i}`,o.search=n.toString();let{href:a}=o;for(let t of(a!==e.getAttribute("src")&&e.setAttribute("src",a),u)){let i=this.getAttribute(t);null!==i&&e.setAttribute(t,i)}}connectedCallback(){let t=this.attachShadow({mode:"open"}),{iframe:e}=this;e.style.border="none",e.setAttribute("allow",l.join(";")),t.appendChild(e),e.addEventListener("load",()=>{this.listenForConfigRequest()})}disconnectedCallback(){this.stopListeningForConfigRequest()}attributeChangedCallback(t){this.updateIframeAttributes(),Object.values(r).map(String).includes(t)&&this.sendConfigToChat()}constructor(...t){super(...t),this.configRequestExpirationTimout=null,this.iframe=document.createElement("iframe"),this.sendConfigToChat=()=>{var t;let{iframe:e,rootUrl:i}=this,{origin:n}=new URL(i),s={name:o.CONFIG,payload:this.chatConfig};null==(t=e.contentWindow)||t.postMessage(s,n)},this.handleConfigRequestedMessage=t=>{let{rootUrl:e}=this,{origin:i}=new URL(e);i===t.origin&&(t=>{let{data:e}=t;return"object"==typeof e&&null!==e&&!!("name"in e&&"string"==typeof e.name)&&!!("payload"in e&&"object"==typeof e.payload)})(t)&&t.data.name===o.CONFIG_REQUESTED&&(this.sendConfigToChat(),this.stopListeningForConfigRequest())},this.stopListeningForConfigRequest=()=>{window.removeEventListener("message",this.handleConfigRequestedMessage),null!==this.configRequestExpirationTimout&&(clearInterval(this.configRequestExpirationTimout),this.configRequestExpirationTimout=null)}}}window.customElements.define("chat-room",h)}();
//# sourceMappingURL=sdk.js.map
